<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A+ Sweets - Order Summary</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header>
    <img src="logo.png" alt="A+ Sweets Logo" width="150" />
    <h1>Order Summary</h1>
  </header>

  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="contact.html">Contact Us</a></li>
      <li><a href="clientRegistrationForm.html">Register</a></li>
    </ul>
  </nav>

  <main>
    <section id="orderDetails">
      <h2>Customer Details</h2>
      <p><strong>First Name:</strong> <span id="firstName"></span></p>
      <p><strong>Surname:</strong> <span id="surname"></span></p>
      <p><strong>Delivery Address:</strong> <span id="deliveryAddress"></span></p>
    </section>

    <section id="paymentDetails">
      <h2>Payment Details</h2>
      <p><strong>Name on Card:</strong> <span id="cardName"></span></p>
      <p><strong>Card Type:</strong> <span id="cardType"></span></p>
      <p><strong>Card Number:</strong> <span id="cardNumber"></span></p>
      <p><strong>Expiry Date:</strong> <span id="expDate"></span></p>
    </section>

    <section id="productsOrdered">
      <h2>Products Ordered</h2>
      <table>
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Price (Each)</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody id="productList">
          <!-- Products will be inserted here by JavaScript -->
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3" style="text-align:right;">Subtotal:</th>
            <th id="subtotalPrice">R0.00</th>
          </tr>
          <tr>
            <th colspan="3" style="text-align:right;">VAT (15%):</th>
            <th id="vatAmount">R0.00</th>
          </tr>
          <tr>
            <th colspan="3" style="text-align:right;">Total:</th>
            <th id="totalPrice">R0.00</th>
          </tr>
        </tfoot>
      </table>
    </section>
  </main>

  <footer>
    <p>&copy; 2021 A+ Sweets</p>
    <p><strong>Business Name:</strong> A+ Sweets</p>
    <p><strong>Owner:</strong> Luthando Vuyo Nxedlana</p>
    <p><strong>Phone:</strong> 081 234 5678</p>
    <p><strong>Email:</strong> <a href="mailto:info@aplussweets.co.za">info@aplussweets.co.za</a></p>
    <p><strong>Location:</strong> Nellmapius, Pretoria</p>
  </footer>

  <script>
    // Utility to get query parameter by name safely
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param) || '';
    }

    // Decode URI component safely
    function safeDecode(param) {
      try {
        return decodeURIComponent(param);
      } catch {
        return param;
      }
    }

    // Fill customer details
    document.getElementById('firstName').textContent = safeDecode(getQueryParam('firstName')) || 'N/A';
    document.getElementById('surname').textContent = safeDecode(getQueryParam('surname')) || 'N/A';
    document.getElementById('deliveryAddress').textContent = safeDecode(getQueryParam('deliveryAddress')) || 'N/A';

    // Fill payment details
    document.getElementById('cardName').textContent = safeDecode(getQueryParam('cardName')) || 'N/A';
    document.getElementById('cardType').textContent = safeDecode(getQueryParam('cardType')) || 'N/A';

    const cardNum = getQueryParam('cardNumber') || '';
    // Mask all but last 4 digits, or show N/A if empty
    const maskedCardNum = cardNum.length >= 4 
      ? '*'.repeat(cardNum.length - 4) + cardNum.slice(-4) 
      : 'N/A';
    document.getElementById('cardNumber').textContent = maskedCardNum;

    const expMonth = getQueryParam('expMonth');
    const expYear = getQueryParam('expYear');
    document.getElementById('expDate').textContent = (expMonth && expYear) ? `${expMonth}/${expYear}` : 'N/A';

    // Product List
    const productCount = parseInt(getQueryParam('productCount'), 10) || 0;
    const productList = document.getElementById('productList');
    let subtotal = 0;

    for (let i = 0; i < productCount; i++) {
      const name = safeDecode(getQueryParam(`prodName${i}`)) || 'Unknown Product';
      const price = parseFloat(getQueryParam(`prodPrice${i}`)) || 0;
      const qty = parseInt(getQueryParam(`prodQty${i}`), 10) || 0;
      const lineTotal = price * qty;
      subtotal += lineTotal;

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${name}</td>
        <td>${qty}</td>
        <td>R${price.toFixed(2)}</td>
        <td>R${lineTotal.toFixed(2)}</td>
      `;
      productList.appendChild(row);
    }

    const vat = subtotal * 0.15;
    const total = subtotal + vat;

    document.getElementById('subtotalPrice').textContent = `R${subtotal.toFixed(2)}`;
    document.getElementById('vatAmount').textContent = `R${vat.toFixed(2)}`;
    document.getElementById('totalPrice').textContent = `R${total.toFixed(2)}`;
  </script>

</body>
</html>
